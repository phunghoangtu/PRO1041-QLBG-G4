CREATE DATABASE QLBG_DUAN1_JAVA
go
USE QLBG_DUAN1_JAVA
GO


CREATE TABLE NhanVien (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    TenNV NVARCHAR(30) DEFAULT NULL,
    GioiTinh INT DEFAULT NULL,
    NgaySinh DATE DEFAULT NULL,
	Sdt VARCHAR(30) DEFAULT NULL,
    DiaChi NVARCHAR(100) DEFAULT NULL,
    Email VARCHAR(50) DEFAULT NULL,
	NgayTao DATETIME2 DEFAULT GETDATE(), 
	MatKhau VARCHAR(64) DEFAULT NULL,
	VaiTro BIT DEFAULT 1, -- 1 nhân viên | 0 quản lý
    TrangThai INT DEFAULT 1,
);
CREATE TABLE CaLam (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    NgayGiaoCa DATE DEFAULT GETDATE(),
	CaTrongNgay INT DEFAULT NULL,
	GioBatDau VARCHAR(15) DEFAULT NULL,
	GioKetThuc VARCHAR(15) DEFAULT NULL,
);
CREATE TABLE GiaoCa (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    IdNV UNIQUEIDENTIFIER,
    IdCaLam UNIQUEIDENTIFIER
    FOREIGN KEY (IdNV) REFERENCES NhanVien(Id),
	FOREIGN KEY (IdCaLam) REFERENCES CaLam(Id)
);
CREATE TABLE KhachHang (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	MaKH VARCHAR(20) UNIQUE,
    TenKH NVARCHAR(30) DEFAULT NULL,
    Sdt VARCHAR(30) DEFAULT NULL,   
    NgayTao DATETIME2 DEFAULT GETDATE(),
    TrangThai INT DEFAULT 1
);
CREATE TABLE HoaDon (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(), 
    IdNV UNIQUEIDENTIFIER,
	IdKH UNIQUEIDENTIFIER DEFAULT NULL,
    MaHD VARCHAR(20) UNIQUE,
    NgayTao DATETIME2 DEFAULT GETDATE(), 
	NgayThanhToan DATETIME2 DEFAULT GETDATE(), 
	TongTien DECIMAL(20,0) DEFAULT NULL,
    GhiChu NVARCHAR(50) DEFAULT NULL,
	HinhThucThanhToan BIT DEFAULT 1, -- 1 tiền mặt | 0 chuyển khoản
    TrangThai INT DEFAULT 1, -- 0 Hủy | 1 chưa thanh toán | đã thanh toán
    FOREIGN KEY (IdNV) REFERENCES NhanVien(Id), 
	FOREIGN KEY (IdKH) REFERENCES KhachHang(Id), 
);

CREATE TABLE ThuongHieu (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    Ten NVARCHAR(30) DEFAULT NULL,
    TrangThai INT DEFAULT 1 
);

CREATE TABLE DeGiay (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    Ten NVARCHAR(30) DEFAULT NULL,
    TrangThai INT DEFAULT 1
);

CREATE TABLE MauSac (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    Ten NVARCHAR(30) DEFAULT NULL,
    TrangThai INT DEFAULT 1
);

CREATE TABLE KichCoGiay (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    KichCo NVARCHAR(5) DEFAULT NULL,
    TrangThai INT DEFAULT 1
);

CREATE TABLE SanPham (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    IdKT UNIQUEIDENTIFIER,
    IdMS UNIQUEIDENTIFIER,
    IdDG UNIQUEIDENTIFIER,
    IdTH UNIQUEIDENTIFIER,
    MaSP VARCHAR(20) UNIQUE,
    TenSP NVARCHAR(30) DEFAULT NULL,
    GiaBan DECIMAL(20,0) DEFAULT 0,  
	GiamGia DECIMAL(20,0) DEFAULT 0,  
    SoLuong INT DEFAULT 0,
    MoTa NVARCHAR(50) DEFAULT NULL,
    TrangThai INT DEFAULT 1,
    FOREIGN KEY (IdKT) REFERENCES KichCoGiay(Id),
    FOREIGN KEY (IdMS) REFERENCES MauSac(Id),
    FOREIGN KEY (IdDG) REFERENCES DeGiay(Id),
    FOREIGN KEY (IdTH) REFERENCES ThuongHieu(Id)
);

CREATE TABLE HoaDonChiTiet (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    IdHD UNIQUEIDENTIFIER,
	IdSP UNIQUEIDENTIFIER,
	SoLuong INT DEFAULT 0,
	DonGia DECIMAL(20,0) DEFAULT 0,
	FOREIGN KEY (IdSP) REFERENCES SanPham(Id),
	FOREIGN KEY (IdHD) REFERENCES HoaDon(Id),
);

CREATE TABLE KhuyenMai(
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	TenKM NVARCHAR(30) DEFAULT NULL,
	MoTa NVARCHAR(50) DEFAULT NULL,
	NgayBatDau DATE DEFAULT NULL,
	NgayKetThuc DATE DEFAULT NULL,	
	MucGiamGia INT DEFAULT 0,
	TrangThai INT DEFAULT 1
);

CREATE TABLE HoaDon_KhuyenMai(
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	IdKM UNIQUEIDENTIFIER,
	IdHD UNIQUEIDENTIFIER,
	SoLuong INT DEFAULT 0,
	FOREIGN KEY (IdKM) REFERENCES KhuyenMai(Id),
	FOREIGN KEY (IdHD) REFERENCES HoaDon(Id),
);
CREATE TABLE SanPham_KhuyenMai(
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	IdKM UNIQUEIDENTIFIER,
	IdSP UNIQUEIDENTIFIER,
	FOREIGN KEY (IdKM) REFERENCES KhuyenMai(Id),
	FOREIGN KEY (IdSP) REFERENCES SanPham(Id),
);

CREATE TABLE NhaCungCap (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    TenNCC NVARCHAR(30) DEFAULT NULL,
    DiaChi NVARCHAR(100) DEFAULT NULL,
    Sdt VARCHAR(30) DEFAULT NULL,
    Email VARCHAR(50) DEFAULT NULL,
    TrangThai INT DEFAULT 1
);
CREATE TABLE DonNhapHang (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    IdNCC UNIQUEIDENTIFIER,
    IdNV UNIQUEIDENTIFIER,
    NgayNhap DATETIME2 DEFAULT GETDATE(),
    TrangThai INT DEFAULT 1,
    FOREIGN KEY (IdNCC) REFERENCES NhaCungCap(Id),
    FOREIGN KEY (IdNV) REFERENCES NhanVien(Id)
);
CREATE TABLE NhapHangChiTiet (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    IdNH UNIQUEIDENTIFIER,
    IdSP UNIQUEIDENTIFIER,
    SoLuong INT DEFAULT 0,
    GiaNhap DECIMAL(20,0) DEFAULT 0,
    ThanhTien DECIMAL(20,0) DEFAULT 0,
    TrangThai INT DEFAULT 1,
    FOREIGN KEY (IdNH) REFERENCES DonNhapHang(Id),
    FOREIGN KEY (IdSP) REFERENCES SanPham(Id)
);

CREATE TABLE DoiHang (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    IdHD UNIQUEIDENTIFIER,
	IdSP UNIQUEIDENTIFIER,
	IdKH UNIQUEIDENTIFIER,
    LyDo NVARCHAR(50) DEFAULT NULL,
	SoLuong INT DEFAULT 0,
    NgayDoi DATETIME2 DEFAULT NULL,
	MoTa NVARCHAR(50) DEFAULT NULL,
    FOREIGN KEY (IdHD) REFERENCES HoaDon(Id),
	FOREIGN KEY (IdSP) REFERENCES SanPham(Id),
	FOREIGN KEY (IdKH) REFERENCES KhachHang(Id),
);

-- INSERT dữ liệu

	INSERT INTO ThuongHieu (Ten) VALUES ('Brand A'),('Brand B'),('Brand C'),('Brand D'),('Brand E');
	INSERT INTO DeGiay (Ten) VALUES ('Type A'),('Type B'),('Type C'),('Type D'),('Type E');
	INSERT INTO MauSac (Ten) VALUES ('Color A'),('Color B'),('Color C'),('Color D'),('Color E');
	INSERT INTO KichCoGiay (KichCo) VALUES ('36'),('37'),('38'),('39'),('40');

	select Id,KichCo from KichCoGiay	
	select Id,Ten from MauSac	
	select Id,Ten from DeGiay
	select Id,Ten from ThuongHieu

	INSERT INTO SanPham (IdKT, IdMS, IdDG, IdTH, MaSP, TenSP, GiaBan, SoLuong, MoTa) VALUES
				('4022A83A-3D4F-4EA8-B1F3-34B63592D76E', 'BCB69855-4714-45D2-A3B4-03882BC85D25', 
				'6C4398E3-AA44-41A2-9D6D-1FBA9F90BDE7', 'C40C97FB-6C13-4DFD-8419-2D38E5186F61', 'SP001', 'Product 1', 100000, 50, 'Product 1 description'),

				('903377F1-E852-4F79-86F7-6C4BBEB57337', 'BCB69855-4714-45D2-A3B4-03882BC85D25', 
				'CB5BE05F-C6F1-403E-A40F-6A16138C10F1', 'A7F17699-A95E-492B-87F4-34350750EA28', 'SP002', 'Product 2', 150000, 30, 'Product 2 description'),  

				('641A672B-CCD9-45BB-B5B7-8716A70224BA', 'BCB69855-4714-45D2-A3B4-03882BC85D25', 
				'6C4398E3-AA44-41A2-9D6D-1FBA9F90BDE7', 'B8B2B399-50C2-492F-8ADC-4C2F3094BBB5', 'SP005', 'Product 5', 300000, 10, 'Product 5 description');

	INSERT INTO NhanVien (TenNV, GioiTinh, NgaySinh, Sdt, DiaChi, Email, MatKhau, VaiTro) VALUES
    ('Employee 1', 1, '1990-01-01', '123456789', 'Address 1', 'sa', '123456', 0),
    ('Employee 2', 0, '1995-02-02', '987654321', 'Address 2', 'employee2@example.com', HASHBYTES('SHA2_256', 'password2'), 0),
    ('Employee 3', 1, '1992-03-03', '456789123', 'Address 3', 'employee3@example.com', HASHBYTES('SHA2_256', 'password3'), 0),
    ('Employee 4', 0, '1988-04-04', '321654987', 'Address 4', 'employee4@example.com', HASHBYTES('SHA2_256', 'password4'), 0),
    ('Employee 5', 1, '1994-05-05', '789123456', 'Address 5', 'employee5@example.com', HASHBYTES('SHA2_256', 'password5'), 0);

	INSERT INTO CaLam (NgayGiaoCa, CaTrongNgay, GioBatDau, GioKetThuc) VALUES
    (GETDATE(), 1, '08:00', '16:00'),
    (GETDATE(), 2, '12:00', '20:00'),
    (GETDATE(), 3, '16:00', '00:00'),
    (GETDATE(), 1, '09:00', '17:00'),
    (GETDATE(), 2, '13:00', '21:00');

	select Id,TenNV from NhanVien	
	select Id from CaLam	

	INSERT INTO GiaoCa (IdNV, IdCaLam) VALUES
    ('0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', '8BB47C3E-D58A-4A52-B06A-562ECBEB01C7'),
    ('0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', '74F5B452-35AA-4BC4-ADD7-6C325DDA83E2'),
    ('FD80DD35-230B-4A2A-8BEA-C537E675950A', 'B905E03B-18BA-453C-8581-4A0F6CE802E5');


	INSERT INTO NhaCungCap (TenNCC, DiaChi, Sdt, Email) VALUES
    ('Supplier 1', 'Address 1', '123456789', 'supplier1@example.com'),
    ('Supplier 2', 'Address 2', '987654321', 'supplier2@example.com'),
    ('Supplier 3', 'Address 3', '456789123', 'supplier3@example.com'),
    ('Supplier 4', 'Address 4', '321654987', 'supplier4@example.com'),
    ('Supplier 5', 'Address 5', '789123456', 'supplier5@example.com');

	select Id from NhaCungCap
	select Id,TenNV from NhanVien

	INSERT INTO DonNhapHang (IdNCC, IdNV, NgayNhap) VALUES
    ('6283F8C3-7E27-4A43-82AF-024ED3D6FB11', '0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', GETDATE()),
    ('9E0BA707-7847-4E6E-8701-15C3930D564C', '0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', GETDATE()),
    ('0E2F6E46-B7E4-425C-8F3A-7D217EC1A89F', 'FD80DD35-230B-4A2A-8BEA-C537E675950A', GETDATE());


	select Id from DonNhapHang
	select * from SanPham
	
	INSERT INTO NhapHangChiTiet (IdNH, IdSP, SoLuong, GiaNhap, ThanhTien) VALUES
    ('7662B853-7BDB-4CFF-B827-20E582097569', '918E1A73-5F3E-4427-9FAE-1D80E3426157', 10, 1000, 10000),
    ('4543C8B6-535D-4D5B-8705-713DEAA935D9', 'CD8A45C9-390A-429F-A82D-68F25442F935', 5, 500, 2500),
    ('F9F189CC-4008-4E65-97BB-83D7AF91098F', 'E663AB3E-27A2-477F-8D6B-B2A430D3FAD8', 8, 800, 6400);

	select Id, TenNV from NhanVien

	INSERT INTO HoaDon (IdNV, MaHD, NgayTao, NgayThanhToan, TongTien, GhiChu) VALUES
    ('0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', 'HD01', GETDATE(), GETDATE(), 1000000, 'Ghi chú 1'),
    ('0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', 'HD02', GETDATE(), GETDATE(), 2000000, 'Ghi chú 2'),
    ('0A905CA6-CE68-46FD-A22C-100F4BF7C2BE', 'HD03', GETDATE(), GETDATE(), 1500000, 'Ghi chú 3');

	select Id from HoaDon
	select Id from SanPham

	INSERT INTO HoaDonChiTiet (IdHD, IdSP, SoLuong, DonGia) VALUES
    ('9332A13F-A802-4B0F-AB0A-92584561D1C0', 'E663AB3E-27A2-477F-8D6B-B2A430D3FAD8', 5, 100000),
    ('8C17EDBA-B599-41A7-B469-6AAF1CCA32FA', '918E1A73-5F3E-4427-9FAE-1D80E3426157', 3, 50000),
    ('3521F267-F07B-4EBC-A5AA-95A79349B165', 'CD8A45C9-390A-429F-A82D-68F25442F935', 4, 200000);

	INSERT INTO KhuyenMai (TenKM, MoTa, NgayBatDau, NgayKetThuc, MucGiamGia) VALUES
    ('KM001', 'Khuyến mãi 1', '2023-01-01', '2023-01-31', 10),
    ('KM002', 'Khuyến mãi 2', '2023-02-01', '2023-02-28', 20),
    ('KM003', 'Khuyến mãi 3', '2023-03-01', '2023-03-31', 15);

	select Id from KhuyenMai
	select Id from HoaDon
	select Id from SanPham

	INSERT INTO HoaDon_KhuyenMai (IdKM, IdHD, SoLuong) VALUES
    ('C00C2218-B353-4DF1-A723-1A1F98308B6C', '9332A13F-A802-4B0F-AB0A-92584561D1C0', 2),
    ('C00C2218-B353-4DF1-A723-1A1F98308B6C', '8C17EDBA-B599-41A7-B469-6AAF1CCA32FA', 1),
    ('C00C2218-B353-4DF1-A723-1A1F98308B6C', '3521F267-F07B-4EBC-A5AA-95A79349B165', 3);

	INSERT INTO SanPham_KhuyenMai (IdKM, IdSP) VALUES
    ('7C443F05-DC36-4E78-92FB-22CBEA5B4BDD', 'E663AB3E-27A2-477F-8D6B-B2A430D3FAD8'),
    ('7C443F05-DC36-4E78-92FB-22CBEA5B4BDD', '918E1A73-5F3E-4427-9FAE-1D80E3426157'),
    ('7C443F05-DC36-4E78-92FB-22CBEA5B4BDD', 'CD8A45C9-390A-429F-A82D-68F25442F935');

	INSERT INTO KhachHang(MaKH,TenKH,Sdt) VALUES
    ('KH00', N'Khách vãng lai','12321456'),
    ('KH01',  N'Khách hàng 1','3123123214'),
    ('KH02', N'Khách hàng 2','1231232114');
	
	select id from KhachHang


